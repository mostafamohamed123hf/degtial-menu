<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title data-i18n="cashierPageTitle">ูุธุงู ุงููุงุดูุฑ | Digital Menu</title>
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="stylesheet" href="../../admin/css/admin.css" />
    <link rel="stylesheet" href="../css/cashier.css" />
    <link rel="stylesheet" href="../css/rating.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>๐ฐ</text></svg>" />
    <meta
      name="description"
      content="Cashier system for Digital Menu - Manage orders and payments" />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet" />

    <!-- Inline script to prevent language flash -->
    <script>
      (function () {
        var savedLang = localStorage.getItem("public-language") || "ar";
        var html = document.documentElement;

        if (savedLang === "en") {
          html.setAttribute("lang", "en");
          html.setAttribute("dir", "ltr");
        } else {
          html.setAttribute("lang", "ar");
          html.setAttribute("dir", "rtl");
        }
      })();
    </script>

    <!-- Hide content until translations are applied -->
    <style>
      body:not(.i18n-ready) {
        opacity: 0;
      }
      body.i18n-ready {
        opacity: 1;
        transition: opacity 0.15s ease-in;
      }
    </style>
  </head>
  <body>
    <!-- Access Denied Modal -->
    <div class="access-denied-overlay" id="access-denied-overlay">
      <div class="access-denied-modal">
        <div class="access-denied-icon">
          <i class="fas fa-lock"></i>
        </div>
        <h2 class="access-denied-title" data-i18n="accessDenied">
          Access Denied
        </h2>
        <p class="access-denied-message" id="access-denied-message"></p>
        <button class="access-denied-button" id="access-denied-button">
          <i class="fas fa-sign-in-alt"></i>
          <span data-i18n="goToLogin">Go to Login</span>
        </button>
      </div>
    </div>

    <header>
      <div class="header-container">
        <div class="back-button">
          <a href="index.html" title="ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ"
            ><i class="fas fa-home"></i
          ></a>
        </div>
        <h1 class="page-title" data-i18n="cashierSystem">ูุธุงู ุงููุงุดูุฑ</h1>
        <div class="header-actions">
          <button
            id="notification-toggle-btn"
            class="header-action-btn"
            data-i18n-title="notificationsOn">
            <i class="fas fa-bell"></i>
          </button>
          <div class="toggle-switch">
            <div class="toggle-switch-container">
              <input type="checkbox" id="switch" checked />
              <label for="switch"></label>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div class="cashier-content">
      <!-- Orders Dashboard -->
      <section class="cashier-section" id="active-orders-section">
        <div class="section-header">
          <h2 class="section-title" data-i18n="activeOrders">ุงูุทูุจุงุช ุงููุดุทุฉ</h2>
        </div>

        <div class="orders-grid" id="orders-grid">
          <!-- Active orders will be loaded here dynamically -->
          <div class="no-orders-message" id="no-orders-message">
            <i class="fas fa-receipt"></i>
            <p data-i18n="noActiveOrders">ูุง ุชูุฌุฏ ุทูุจุงุช ูุดุทุฉ ุญุงููุงู</p>
            <small data-i18n="tableOrdersWillAppear"
              >ุทูุจุงุช ุงูุทุงููุงุช ุณุชุธูุฑ ููุง ุนูุฏ ุฅุฏุฎุงู ุฑูู ุงูุทุงููุฉ</small
            >
          </div>
        </div>
      </section>

      <!-- Quick Order Processing -->
      <section class="cashier-section" id="quick-processing-section">
        <div class="section-header">
          <h2 class="section-title" data-i18n="quickManagement">ุฅุฏุงุฑุฉ ุณุฑูุนุฉ</h2>
        </div>

        <div class="quick-actions">
          <div class="qr-scan-container">
            <div class="manual-table-entry">
              <input
                type="number"
                id="table-number-input"
                min="1"
                placeholder="ุฑูู ุงูุทุงููุฉ"
                data-i18n-placeholder="tableNumber" />
              <button class="check-table-button" id="check-table-button">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>

          <div class="cashier-actions">
            <button class="create-order-button" id="create-order-button">
              <i class="fas fa-plus-circle"></i>
              <span data-i18n="createNewOrder">ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ</span>
            </button>
          </div>
        </div>
      </section>

      <!-- Reservations Section -->
      <section class="cashier-section" id="reservations-section">
        <div class="section-header">
          <h2 class="section-title" data-i18n="todayReservations">
            ุญุฌูุฒุงุช ุงูููู
          </h2>
          <div class="reservation-date-picker">
            <input
              type="date"
              id="reservation-date"
              class="reservation-date-input" />
            <button id="refresh-reservations" class="refresh-button">
              <i class="fas fa-sync-alt"></i>
            </button>
          </div>
        </div>

        <div class="reservations-container">
          <div class="reservations-grid" id="reservations-grid">
            <!-- Reservations will be loaded here dynamically -->
            <div class="no-reservations-message" id="no-reservations-message">
              <i class="fas fa-calendar-alt"></i>
              <p data-i18n="noReservationsForDate">
                ูุง ุชูุฌุฏ ุญุฌูุฒุงุช ููููู ุงููุญุฏุฏ
              </p>
              <small data-i18n="reservationsWillAppear"
                >ุณุชุธูุฑ ููุง ุฌููุน ุงูุญุฌูุฒุงุช ุงููุชุงุญุฉ ูู ุงูููู ุงููุญุฏุฏ</small
              >
            </div>
          </div>
        </div>
      </section>

      <!-- Recent Activity -->
      <section class="cashier-section" id="recent-activity-section">
        <div class="recent-activity-header">
          <h2 class="section-title" data-i18n="recentActivity">
            ุงููุดุงุท ุงูุฃุฎูุฑ
          </h2>
          <!-- Reset button will be added here dynamically -->
        </div>

        <div class="activity-list" id="activity-list">
          <!-- Recent activity will be loaded here -->
          <div class="empty-message">
            <i class="fas fa-history"></i>
            <p data-i18n="noRecentActivity">ูุง ููุฌุฏ ูุดุงุท ุญุฏูุซ</p>
          </div>
        </div>
      </section>
    </div>

    <!-- Order Details Modal -->
    <div class="modal" id="order-details-modal">
      <div class="modal-content">
        <span class="close-modal" id="close-order-modal">&times;</span>
        <h2 id="order-details-title" data-i18n="orderDetails">ุชูุงุตูู ุงูุทูุจ</h2>

        <div class="order-details-container">
          <!-- Order info will be added dynamically -->

          <div class="order-items-table">
            <table class="items-table">
              <thead>
                <tr>
                  <th data-i18n="item">ุงูุตูู</th>
                  <th data-i18n="price">ุงูุณุนุฑ</th>
                  <th data-i18n="quantity">ุงููููุฉ</th>
                  <th data-i18n="total">ุงูุฅุฌูุงูู</th>
                </tr>
              </thead>
              <tbody id="order-items">
                <!-- Order items will be loaded here -->
              </tbody>
            </table>

            <table class="totals-table">
              <tr>
                <td data-i18n="subtotal">ุงููุฌููุน ุงููุฑุนู:</td>
                <td id="order-subtotal"></td>
              </tr>
              <tr id="tax-row">
                <td data-i18n="tax">ุงูุถุฑูุจุฉ:</td>
                <td id="order-tax"></td>
              </tr>
              <tr id="service-tax-row">
                <td data-i18n="serviceTax">ุถุฑูุจุฉ ุงูุฎุฏูุฉ:</td>
                <td id="order-service-tax"></td>
              </tr>
              <tr id="discount-row">
                <td data-i18n="discount">ุงูุฎุตู:</td>
                <td id="order-discount"></td>
              </tr>
              <tr id="loyalty-discount-row">
                <td>
                  <span data-i18n="loyaltyDiscount">ุฎุตู ููุงุท ุงูููุงุก</span
                  ><span id="loyalty-discount-info"></span>:
                </td>
                <td id="order-loyalty-discount"></td>
              </tr>
              <tr class="grand-total">
                <td data-i18n="total">ุงูุฅุฌูุงูู:</td>
                <td id="order-total"></td>
              </tr>
            </table>
          </div>

          <div class="order-actions">
            <button class="complete-order-button" id="complete-order-button">
              <i class="fas fa-check-circle"></i>
              <span data-i18n="completeOrderAndBill"
                >ุฅููุงุก ุงูุทูุจ ูุฅุตุฏุงุฑ ุงููุงุชูุฑุฉ</span
              >
            </button>
            <button class="print-receipt-button" id="print-receipt-button">
              <i class="fas fa-print"></i>
              <span data-i18n="printReceipt">ุทุจุงุนุฉ ุงูุฅูุตุงู</span>
            </button>
            <button
              class="print-kitchen-receipt-button"
              id="print-kitchen-receipt-button">
              <i class="fas fa-utensils"></i>
              <span data-i18n="printKitchenReceipt">ุทุจุงุนุฉ ุฅูุตุงู ุงููุทุจุฎ</span>
            </button>
            <button class="cancel-order-button" id="cancel-order-button">
              <i class="fas fa-ban"></i>
              <span data-i18n="cancelOrder">ุฅูุบุงุก ุงูุทูุจ</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Create New Order Modal -->
    <div class="modal" id="create-order-modal">
      <div class="modal-content new-order-modal-content">
        <span class="close-modal" id="close-create-order-modal">&times;</span>
        <h2 id="create-order-title" data-i18n="createNewOrder">
          ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
        </h2>

        <div class="new-order-container">
          <!-- Table Number Selection -->
          <div class="order-table-selection">
            <label for="new-order-table-number" data-i18n="tableNumber"
              >ุฑูู ุงูุทุงููุฉ</label
            >
            <input
              type="number"
              id="new-order-table-number"
              min="1"
              placeholder="ุฃุฏุฎู ุฑูู ุงูุทุงููุฉ"
              data-i18n-placeholder="enterTableNumber"
              required />
          </div>

          <!-- Products and Offers Tabs -->
          <div class="order-items-tabs">
            <div class="tabs-header">
              <button
                class="tab-btn active"
                id="products-tab"
                data-tab="products">
                <i class="fas fa-box"></i>
                <span data-i18n="selectProducts">ุงุฎุชุฑ ุงูููุชุฌุงุช</span>
              </button>
              <button class="tab-btn" id="offers-tab" data-tab="offers">
                <i class="fas fa-tag"></i>
                <span data-i18n="availableOffers">ุงูุนุฑูุถ ุงููุชุงุญุฉ</span>
              </button>
            </div>

            <!-- Products Section -->
            <div
              class="order-products-section tab-content active"
              id="products-content">
              <div class="products-header">
                <div class="category-filter">
                  <button class="category-btn active" data-category="all">
                    <span data-i18n="allCategories">ุฌููุน ุงููุฆุงุช</span>
                  </button>
                </div>
              </div>

              <div class="products-grid" id="new-order-products-grid">
                <!-- Products will be loaded here dynamically -->
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span data-i18n="loadingProducts"
                    >ุฌุงุฑู ุชุญููู ุงูููุชุฌุงุช...</span
                  >
                </div>
              </div>
            </div>

            <!-- Offers Section -->
            <div class="order-offers-section tab-content" id="offers-content">
              <div class="offers-grid" id="new-order-offers-grid">
                <!-- Offers will be loaded here dynamically -->
                <div class="loading-spinner">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span data-i18n="loadingOffers">ุฌุงุฑู ุชุญููู ุงูุนุฑูุถ...</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Cart Section -->
          <div class="order-cart-section">
            <h3 data-i18n="orderCart" data-count="0">ุณูุฉ ุงูุทูุจ</h3>
            <div class="cart-items" id="new-order-cart-items">
              <div class="empty-cart-message">
                <i class="fas fa-shopping-cart"></i>
                <p data-i18n="emptyCart">ุงูุณูุฉ ูุงุฑุบุฉ</p>
              </div>
            </div>

            <!-- Order Summary -->
            <div class="order-summary">
              <div class="summary-row">
                <span data-i18n="subtotal">ุงููุฌููุน ุงููุฑุนู:</span>
                <span id="new-order-subtotal">0.00 ุฌููู</span>
              </div>
              <div class="summary-row">
                <span data-i18n="tax">ุงูุถุฑูุจุฉ:</span>
                <span id="new-order-tax">0.00 ุฌููู</span>
              </div>
              <div class="summary-row">
                <span data-i18n="serviceTax">ุถุฑูุจุฉ ุงูุฎุฏูุฉ:</span>
                <span id="new-order-service-tax">0.00 ุฌููู</span>
              </div>
              <div class="summary-row total-row">
                <span data-i18n="total">ุงูุฅุฌูุงูู:</span>
                <span id="new-order-total">0.00 ุฌููู</span>
              </div>
            </div>

            <!-- Submit Button -->
            <button class="submit-order-button" id="submit-new-order-button">
              <i class="fas fa-check-circle"></i>
              <span data-i18n="submitOrder">ุชุฃููุฏ ุงูุทูุจ</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Product Addons Modal -->
    <div class="modal" id="product-addons-modal">
      <div class="modal-content addons-modal-content">
        <span class="close-modal" id="close-addons-modal">&times;</span>
        <h2 id="addons-product-name">ุงุฎุชุฑ ุงูุฅุถุงูุงุช</h2>

        <div class="addons-container" id="addons-container">
          <!-- Addons will be loaded here dynamically -->
        </div>

        <div class="modal-footer addons-footer">
          <div class="addons-total-price">
            <span class="addons-total-price-label" data-i18n="total"
              >ุงูุฅุฌูุงูู</span
            >
            <span class="addons-total-price-value" id="addons-total-price"
              >0.00 ุฌููู</span
            >
          </div>
          <div class="addon-quantity-selector">
            <label for="addon-quantity" data-i18n="quantity">ุงููููุฉ:</label>
            <button class="quantity-btn" id="addon-quantity-minus">
              <i class="fas fa-minus"></i>
            </button>
            <input type="number" id="addon-quantity" value="1" min="1" />
            <button class="quantity-btn" id="addon-quantity-plus">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <button class="add-to-cart-button" id="add-to-cart-button">
            <i class="fas fa-cart-plus"></i>
            <span data-i18n="addToCart">ุฅุถุงูุฉ ุฅูู ุงูุณูุฉ</span>
          </button>
        </div>
      </div>
    </div>

    <!-- New notification system -->
    <div class="cashier-notifications" id="cashier-notifications"></div>

    <!-- Fixed notifications system -->
    <div id="fixed-notifications"></div>

    <!-- Audio for notifications -->
    <audio
      id="notification-sound"
      src="../../sounds/notification.mp3"
      preload="auto"></audio>

    <script src="../js/auth.js"></script>
    <script src="../js/i18n.js"></script>
    <script src="../js/global-settings-loader.js"></script>
    <script src="../js/cashier.js"></script>
  </body>
</html>
